<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suno AI 歌詞創作助手</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Suno AI 歌詞創作助手</h1>
            <p class="subtitle">AI 智慧生成 + 模板編輯，完美支援 Suno 格式</p>
            <button id="history-btn" class="btn-history" title="版本歷史">
                <span class="history-icon">📜</span>
                <span class="history-text">版本歷史</span>
            </button>
        </header>

        <!-- 版本歷史面板 -->
        <div id="history-panel" class="history-panel">
            <div class="history-panel-header">
                <h3>版本歷史</h3>
                <button id="history-close" class="history-close-btn">&times;</button>
            </div>
            <div class="history-panel-actions">
                <button id="history-export-all" class="btn-secondary btn-small">匯出全部</button>
                <label class="btn-secondary btn-small btn-file">
                    匯入
                    <input type="file" id="history-file-input" accept=".json" hidden>
                </label>
            </div>
            <div id="version-list" class="version-list">
                <p class="empty-history">尚無版本記錄</p>
            </div>
        </div>
        <div id="history-overlay" class="history-overlay"></div>

        <div class="tabs">
            <button class="tab active" data-tab="ai-generate">AI 生成</button>
            <button class="tab" data-tab="template-edit">模板編輯</button>
            <button class="tab" data-tab="tags-ref">標籤參考</button>
        </div>

        <!-- AI 生成頁面 -->
        <div id="ai-generate" class="tab-content active">
            <div class="form-section">
                <div class="form-group">
                    <label>API 模式</label>
                    <div class="api-mode-selector">
                        <label class="radio-label">
                            <input type="radio" name="api-mode" value="backend" id="api-mode-backend" checked>
                            <span>本地後端</span>
                            <small>使用 claude login 認證 (Max/Pro)</small>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="api-mode" value="direct" id="api-mode-direct">
                            <span>直接 API</span>
                            <small>使用 API Key (按量計費)</small>
                        </label>
                    </div>
                </div>

                <div id="backend-config" class="form-group">
                    <label for="backend-url">後端 URL</label>
                    <div class="api-key-wrapper">
                        <input type="text" id="backend-url" value="http://localhost:8000">
                        <button id="check-backend" class="btn-icon" title="檢查連線">🔍</button>
                    </div>
                    <small id="backend-status">啟動後端: cd backend && pip install -r requirements.txt && python main.py</small>
                </div>

                <div id="direct-api-config" class="form-group hidden">
                    <label for="api-key">Claude API Key</label>
                    <div class="api-key-wrapper">
                        <input type="password" id="api-key" placeholder="sk-ant-...">
                        <button id="toggle-api-key" class="btn-icon" title="顯示/隱藏">👁</button>
                    </div>
                    <small>API Key 只會存在本地瀏覽器，不會上傳</small>
                </div>

                <div class="form-group">
                    <label for="song-theme">歌曲主題</label>
                    <input type="text" id="song-theme" placeholder="例：夏日海灘的愛情故事">
                </div>

                <div class="form-group">
                    <label>AI 創作模式</label>
                    <div class="ai-mode-selector">
                        <label class="radio-label ai-mode-option">
                            <input type="radio" name="ai-mode" value="manual" id="ai-mode-manual" checked>
                            <span class="ai-mode-icon">🎛️</span>
                            <div class="ai-mode-text">
                                <span class="ai-mode-title">手動設定</span>
                                <small>自行選擇所有風格參數</small>
                            </div>
                        </label>
                        <label class="radio-label ai-mode-option">
                            <input type="radio" name="ai-mode" value="optimize" id="ai-mode-optimize">
                            <span class="ai-mode-icon">✨</span>
                            <div class="ai-mode-text">
                                <span class="ai-mode-title">AI 優化</span>
                                <small>AI 補充未設定的參數</small>
                            </div>
                        </label>
                        <label class="radio-label ai-mode-option">
                            <input type="radio" name="ai-mode" value="auto" id="ai-mode-auto">
                            <span class="ai-mode-icon">🤖</span>
                            <div class="ai-mode-text">
                                <span class="ai-mode-title">AI 全自動</span>
                                <small>只需輸入主題，AI 決定一切</small>
                            </div>
                        </label>
                    </div>
                    <div id="ai-mode-hint" class="ai-mode-hint">
                        <span class="hint-icon">💡</span>
                        <span class="hint-text">手動設定所有參數，完全控制生成結果</span>
                    </div>
                </div>

                <!-- AI 全自動模式的自訂偏好描述 -->
                <div id="auto-mode-custom-pref" class="form-group hidden">
                    <label for="custom-preference">
                        <span>自訂偏好描述</span>
                        <span class="optional-tag">（選填）</span>
                    </label>
                    <textarea id="custom-preference" rows="3" placeholder="例：我希望這首歌有 80 年代復古的感覺、副歌要有很強的記憶點、想要加入薩克斯風 solo..."></textarea>
                    <small>輸入任何你對這首歌的想法或期望，AI 會在創作時參考</small>
                </div>

                <div id="manual-settings">
                <div class="form-row">
                    <div class="form-group">
                        <label for="song-genre">音樂風格</label>
                        <select id="song-genre">
                            <option value="">選擇風格...</option>
                            <option value="pop">Pop 流行</option>
                            <option value="rock">Rock 搖滾</option>
                            <option value="hip-hop">Hip Hop 嘻哈</option>
                            <option value="r&b">R&B</option>
                            <option value="electronic">Electronic 電子</option>
                            <option value="jazz">Jazz 爵士</option>
                            <option value="country">Country 鄉村</option>
                            <option value="folk">Folk 民謠</option>
                            <option value="classical">Classical 古典</option>
                            <option value="k-pop">K-Pop</option>
                            <option value="j-pop">J-Pop</option>
                            <option value="c-pop">C-Pop 華語流行</option>
                            <option value="ballad">Ballad 抒情</option>
                            <option value="lo-fi">Lo-Fi</option>
                            <option value="metal">Metal 金屬</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="song-mood">情緒氛圍</label>
                        <select id="song-mood">
                            <option value="">選擇情緒...</option>
                            <option value="happy">Happy 快樂</option>
                            <option value="sad">Sad 悲傷</option>
                            <option value="energetic">Energetic 活力</option>
                            <option value="romantic">Romantic 浪漫</option>
                            <option value="melancholic">Melancholic 憂鬱</option>
                            <option value="peaceful">Peaceful 平靜</option>
                            <option value="angry">Angry 憤怒</option>
                            <option value="nostalgic">Nostalgic 懷舊</option>
                            <option value="hopeful">Hopeful 希望</option>
                            <option value="dreamy">Dreamy 夢幻</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="song-language">歌詞語言</label>
                        <select id="song-language">
                            <option value="zh-TW">繁體中文</option>
                            <option value="zh-CN">簡體中文</option>
                            <option value="en">English</option>
                            <option value="ja">日本語</option>
                            <option value="ko">한국어</option>
                            <option value="es">Spanish 西班牙語</option>
                            <option value="mixed-en-zh">中英混合</option>
                            <option value="mixed-en-ja">日英混合</option>
                            <option value="mixed-en-ko">韓英混合</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>歌曲結構</label>
                    <!-- 結構模板快速選擇 -->
                    <div class="structure-templates">
                        <button type="button" class="template-btn structure-template" data-template="pop-standard" title="流行標準結構">流行曲</button>
                        <button type="button" class="template-btn structure-template" data-template="verse-chorus" title="簡單段落副歌">簡單</button>
                        <button type="button" class="template-btn structure-template" data-template="ballad" title="抒情曲結構">抒情</button>
                        <button type="button" class="template-btn structure-template" data-template="edm" title="電子舞曲結構">電子</button>
                        <button type="button" class="template-btn structure-template" data-template="hip-hop" title="嘻哈結構">嘻哈</button>
                    </div>
                    <!-- 結構編輯器 -->
                    <div class="structure-editor">
                        <div id="structure-list" class="structure-list">
                            <!-- 動態生成的結構項目 -->
                        </div>
                        <div class="structure-add-section">
                            <select id="add-section-type">
                                <option value="intro">Intro 前奏</option>
                                <option value="verse">Verse 主歌</option>
                                <option value="pre-chorus">Pre-Chorus 導歌</option>
                                <option value="chorus">Chorus 副歌</option>
                                <option value="bridge">Bridge 橋段</option>
                                <option value="outro">Outro 尾奏</option>
                                <option value="instrumental">Instrumental 純音樂</option>
                                <option value="drop">Drop 節拍落點</option>
                                <option value="hook">Hook 記憶點</option>
                                <option value="break">Break 休息段</option>
                            </select>
                            <button type="button" id="add-section-btn" class="btn-secondary btn-small">+ 新增段落</button>
                        </div>
                    </div>
                    <small class="structure-hint">點擊拖動排序 • 點擊 × 移除段落 • 使用模板快速設定</small>
                </div>

                <div class="form-group">
                    <label for="extra-instructions">額外指示（可選）</label>
                    <textarea id="extra-instructions" rows="2" placeholder="例：副歌要有記憶點、使用押韻..."></textarea>
                </div>

                <!-- Styles 區塊 -->
                <div class="section-divider">
                    <span>Style of Music</span>
                </div>

                <div class="form-group">
                    <label for="style-prompt">風格描述 (Style Prompt)</label>
                    <textarea id="style-prompt" rows="2" placeholder="例：Sultry RnB, smooth vocals, groovy bass, 90s vibe" maxlength="1000"></textarea>
                    <small>描述音樂風格、樂器、人聲特色等，這會直接影響 Suno 生成的音樂</small>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="vocal-style">人聲風格</label>
                        <select id="vocal-style">
                            <option value="">選擇人聲...</option>
                            <option value="male">Male Vocal 男聲</option>
                            <option value="female">Female Vocal 女聲</option>
                            <option value="duet">Duet 對唱</option>
                            <option value="choir">Choir 合唱</option>
                            <option value="rap">Rap 饒舌</option>
                            <option value="whisper">Whisper 輕聲</option>
                            <option value="powerful">Powerful 有力</option>
                            <option value="soft">Soft 柔和</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="tempo">節奏速度</label>
                        <select id="tempo">
                            <option value="">選擇速度...</option>
                            <option value="slow">Slow 慢速 (60-80 BPM)</option>
                            <option value="medium">Medium 中速 (80-120 BPM)</option>
                            <option value="fast">Fast 快速 (120-140 BPM)</option>
                            <option value="very-fast">Very Fast 極快 (140+ BPM)</option>
                        </select>
                    </div>
                </div>

                <!-- 歌手/聲線配置 -->
                <div class="form-group">
                    <label>歌手聲線特色</label>
                    <div class="singer-config">
                        <div class="form-row">
                            <div class="form-group compact">
                                <label for="vocal-tone">音色</label>
                                <select id="vocal-tone">
                                    <option value="">選擇音色...</option>
                                    <option value="smooth">Smooth 滑順</option>
                                    <option value="raspy">Raspy 沙啞</option>
                                    <option value="breathy">Breathy 氣聲</option>
                                    <option value="crisp">Crisp 清脆</option>
                                    <option value="warm">Warm 溫暖</option>
                                    <option value="bright">Bright 明亮</option>
                                    <option value="dark">Dark 低沉</option>
                                    <option value="nasal">Nasal 鼻音</option>
                                </select>
                            </div>
                            <div class="form-group compact">
                                <label for="vocal-register">音域</label>
                                <select id="vocal-register">
                                    <option value="">選擇音域...</option>
                                    <option value="soprano">Soprano 女高音</option>
                                    <option value="alto">Alto 女低音</option>
                                    <option value="tenor">Tenor 男高音</option>
                                    <option value="baritone">Baritone 男中音</option>
                                    <option value="bass">Bass 男低音</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>演唱技巧</label>
                            <div class="style-tags compact">
                                <button type="button" class="style-tag vocal-tech-tag" data-style="vibrato">Vibrato 顫音</button>
                                <button type="button" class="style-tag vocal-tech-tag" data-style="falsetto">Falsetto 假聲</button>
                                <button type="button" class="style-tag vocal-tech-tag" data-style="belting">Belting 飽滿高音</button>
                                <button type="button" class="style-tag vocal-tech-tag" data-style="melisma">Melisma 轉音</button>
                                <button type="button" class="style-tag vocal-tech-tag" data-style="vocal fry">Vocal Fry 氣泡音</button>
                                <button type="button" class="style-tag vocal-tech-tag" data-style="ad-libs">Ad-libs 即興</button>
                                <button type="button" class="style-tag vocal-tech-tag" data-style="harmonies">Harmonies 和聲</button>
                                <button type="button" class="style-tag vocal-tech-tag" data-style="runs">Runs 花式轉音</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 樂器配器配置 -->
                <div class="form-group">
                    <label>樂器配器</label>
                    <div class="instrument-config">
                        <div class="instrument-category">
                            <span class="category-label">弦樂</span>
                            <div class="style-tags compact">
                                <button type="button" class="style-tag instrument-tag" data-style="acoustic guitar">Acoustic Guitar</button>
                                <button type="button" class="style-tag instrument-tag" data-style="electric guitar">Electric Guitar</button>
                                <button type="button" class="style-tag instrument-tag" data-style="bass guitar">Bass Guitar</button>
                                <button type="button" class="style-tag instrument-tag" data-style="violin">Violin</button>
                                <button type="button" class="style-tag instrument-tag" data-style="cello">Cello</button>
                                <button type="button" class="style-tag instrument-tag" data-style="strings ensemble">Strings</button>
                                <button type="button" class="style-tag instrument-tag" data-style="ukulele">Ukulele</button>
                            </div>
                        </div>
                        <div class="instrument-category">
                            <span class="category-label">鍵盤</span>
                            <div class="style-tags compact">
                                <button type="button" class="style-tag instrument-tag" data-style="piano">Piano</button>
                                <button type="button" class="style-tag instrument-tag" data-style="electric piano">Electric Piano</button>
                                <button type="button" class="style-tag instrument-tag" data-style="organ">Organ</button>
                                <button type="button" class="style-tag instrument-tag" data-style="synth">Synth</button>
                                <button type="button" class="style-tag instrument-tag" data-style="synth pads">Synth Pads</button>
                                <button type="button" class="style-tag instrument-tag" data-style="synth lead">Synth Lead</button>
                            </div>
                        </div>
                        <div class="instrument-category">
                            <span class="category-label">節奏</span>
                            <div class="style-tags compact">
                                <button type="button" class="style-tag instrument-tag" data-style="drums">Drums</button>
                                <button type="button" class="style-tag instrument-tag" data-style="808 drums">808</button>
                                <button type="button" class="style-tag instrument-tag" data-style="percussion">Percussion</button>
                                <button type="button" class="style-tag instrument-tag" data-style="hi-hat">Hi-hat</button>
                                <button type="button" class="style-tag instrument-tag" data-style="claps">Claps</button>
                                <button type="button" class="style-tag instrument-tag" data-style="drum machine">Drum Machine</button>
                            </div>
                        </div>
                        <div class="instrument-category">
                            <span class="category-label">其他</span>
                            <div class="style-tags compact">
                                <button type="button" class="style-tag instrument-tag" data-style="brass section">Brass</button>
                                <button type="button" class="style-tag instrument-tag" data-style="saxophone">Saxophone</button>
                                <button type="button" class="style-tag instrument-tag" data-style="trumpet">Trumpet</button>
                                <button type="button" class="style-tag instrument-tag" data-style="flute">Flute</button>
                                <button type="button" class="style-tag instrument-tag" data-style="harmonica">Harmonica</button>
                                <button type="button" class="style-tag instrument-tag" data-style="orchestra">Orchestra</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>快速風格標籤</label>
                    <div class="style-tags">
                        <button type="button" class="style-tag" data-style="lo-fi">Lo-Fi</button>
                        <button type="button" class="style-tag" data-style="cinematic">Cinematic</button>
                        <button type="button" class="style-tag" data-style="ambient">Ambient</button>
                        <button type="button" class="style-tag" data-style="groovy">Groovy</button>
                        <button type="button" class="style-tag" data-style="upbeat">Upbeat</button>
                        <button type="button" class="style-tag" data-style="chill">Chill</button>
                        <button type="button" class="style-tag" data-style="ethereal">Ethereal</button>
                        <button type="button" class="style-tag" data-style="punchy">Punchy</button>
                    </div>
                </div>

                <!-- Advanced Options 區塊 -->
                <div class="section-divider">
                    <span>Advanced Options</span>
                    <button type="button" id="toggle-advanced" class="btn-text-small">展開</button>
                </div>

                <div id="advanced-options" class="advanced-options collapsed">
                    <!-- MAX Mode 區塊 -->
                    <div class="advanced-subsection">
                        <h4 class="subsection-title">MAX Mode（高品質模式）</h4>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="max-mode-enabled">
                                <span>啟用 MAX Mode</span>
                            </label>
                            <small>適合原聲/民謠/古典等有機音樂，可大幅提升音質和真實感</small>
                        </div>
                        <div id="max-mode-options" class="max-mode-options hidden">
                            <div class="form-group">
                                <label>品質參數</label>
                                <div class="checkbox-grid">
                                    <label class="checkbox-label"><input type="checkbox" name="max-params" value="QUALITY" checked> QUALITY</label>
                                    <label class="checkbox-label"><input type="checkbox" name="max-params" value="REALISM" checked> REALISM</label>
                                    <label class="checkbox-label"><input type="checkbox" name="max-params" value="REAL_INSTRUMENTS" checked> REAL_INSTRUMENTS</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- START_ON 控制 -->
                    <div class="advanced-subsection">
                        <h4 class="subsection-title">歌曲起始控制</h4>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="skip-intro">
                                <span>跳過前奏，直接從歌詞開始</span>
                            </label>
                            <small>使用 [START_ON] 標籤讓人聲立即開始</small>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="lyric-bleed-protection">
                                <span>防止 Prompt 被唱出（Lyric Bleed Protection）</span>
                            </label>
                            <small>在歌詞開頭加入分隔符號，避免 prompt 內容被誤唱</small>
                        </div>
                    </div>

                    <!-- Realism 描述詞 -->
                    <div class="advanced-subsection">
                        <h4 class="subsection-title">真實感描述詞（適合原聲音樂）</h4>
                        <div class="form-group">
                            <label>錄音特徵</label>
                            <div class="style-tags compact">
                                <button type="button" class="style-tag realism-tag" data-style="small room acoustics">小房間</button>
                                <button type="button" class="style-tag realism-tag" data-style="close mic presence">近距麥克風</button>
                                <button type="button" class="style-tag realism-tag" data-style="tape saturation">磁帶飽和</button>
                                <button type="button" class="style-tag realism-tag" data-style="analog warmth">類比溫暖</button>
                                <button type="button" class="style-tag realism-tag" data-style="one-take performance">一次錄音</button>
                                <button type="button" class="style-tag realism-tag" data-style="natural dynamics">自然動態</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>人聲細節</label>
                            <div class="style-tags compact">
                                <button type="button" class="style-tag realism-tag" data-style="breath detail">呼吸聲</button>
                                <button type="button" class="style-tag realism-tag" data-style="vocal fry">氣泡音</button>
                                <button type="button" class="style-tag realism-tag" data-style="natural timing drift">自然節拍</button>
                                <button type="button" class="style-tag realism-tag" data-style="intimate whisper-to-belt">輕聲到飽滿</button>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>樂器細節</label>
                            <div class="style-tags compact">
                                <button type="button" class="style-tag realism-tag" data-style="pick noise">撥弦聲</button>
                                <button type="button" class="style-tag realism-tag" data-style="fret squeak">換把位聲</button>
                                <button type="button" class="style-tag realism-tag" data-style="finger movement noise">手指移動聲</button>
                                <button type="button" class="style-tag realism-tag" data-style="pedal noise">踏板聲</button>
                            </div>
                        </div>
                    </div>

                    <!-- 滑桿區 -->
                    <div class="advanced-subsection">
                        <h4 class="subsection-title">參數調整</h4>
                        <div class="slider-group">
                            <div class="slider-header">
                                <label for="weirdness-slider">Weirdness（實驗性）</label>
                                <span id="weirdness-value">50%</span>
                            </div>
                            <input type="range" id="weirdness-slider" min="0" max="100" value="50" class="slider">
                            <div class="slider-labels">
                                <span>Safe 保守</span>
                                <span>Chaos 瘋狂</span>
                            </div>
                            <small>0-30% 商業流行 | 40-60% 平衡 | 70-100% 實驗創新</small>
                        </div>

                        <div class="slider-group">
                            <div class="slider-header">
                                <label for="style-influence-slider">Style Influence（風格影響力）</label>
                                <span id="style-influence-value">70%</span>
                            </div>
                            <input type="range" id="style-influence-slider" min="0" max="100" value="70" class="slider">
                            <div class="slider-labels">
                                <span>Loose 寬鬆</span>
                                <span>Strict 嚴格</span>
                            </div>
                            <small>模糊風格用 70-90% | 精確風格用 40-60%</small>
                        </div>
                    </div>

                    <!-- 其他選項 -->
                    <div class="advanced-subsection">
                        <h4 class="subsection-title">其他選項</h4>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="instrumental-only">
                                <span>純音樂模式（無人聲）</span>
                            </label>
                        </div>

                        <div class="form-group">
                            <label for="negative-prompt">排除元素（Exclude Styles）</label>
                            <input type="text" id="negative-prompt" placeholder="例：Male Vocal, Electronic, Autotune">
                            <small>直接列出要排除的元素，比使用 "no" 更可靠</small>
                        </div>

                        <div class="form-group">
                            <label for="mastering-style">母帶處理風格</label>
                            <select id="mastering-style">
                                <option value="">選擇母帶風格...</option>
                                <option value="natural dry close mixing">自然乾淨</option>
                                <option value="polished professional sound with wide stereo image">專業拋光</option>
                                <option value="tape saturation with analog warmth">類比溫暖</option>
                                <option value="lo-fi intimacy with tape warmth">Lo-Fi 親密</option>
                                <option value="punchy dynamics with hi-fi clarity">動態清晰</option>
                            </select>
                        </div>
                    </div>
                </div>
                </div><!-- end manual-settings -->

                <button id="generate-btn" class="btn-primary">
                    <span class="btn-text">生成歌詞</span>
                    <span class="btn-loading" style="display:none;">生成中...</span>
                </button>
            </div>

            <div class="output-section">
                <div class="output-header">
                    <h3>生成結果</h3>
                    <div class="output-actions">
                        <button id="copy-btn" class="btn-secondary" disabled>複製</button>
                        <button id="edit-btn" class="btn-secondary" disabled>編輯</button>
                    </div>
                </div>
                <div id="output-area" class="output-area">
                    <p class="placeholder-text">生成的歌詞會顯示在這裡...</p>
                </div>

                <!-- 迭代優化區塊 -->
                <div id="iterate-section" class="iterate-section hidden">
                    <div class="iterate-header">
                        <h4>迭代優化</h4>
                        <span class="iterate-count">第 <span id="iteration-num">1</span> 次優化</span>
                    </div>

                    <!-- 優化目標選擇 -->
                    <div class="iterate-target-selector">
                        <label class="iterate-target-option active" data-target="lyrics">
                            <input type="radio" name="iterate-target" value="lyrics" checked>
                            <span class="target-icon">📝</span>
                            <span class="target-label">歌詞</span>
                        </label>
                        <label class="iterate-target-option" data-target="style">
                            <input type="radio" name="iterate-target" value="style">
                            <span class="target-icon">🎨</span>
                            <span class="target-label">Style</span>
                        </label>
                        <label class="iterate-target-option" data-target="both">
                            <input type="radio" name="iterate-target" value="both">
                            <span class="target-icon">🔄</span>
                            <span class="target-label">全部</span>
                        </label>
                    </div>

                    <div class="iterate-input-wrapper">
                        <textarea id="iterate-instruction" rows="2" placeholder="輸入優化指示，例如：副歌更有力、加入更多押韻、改成更浪漫的風格..."></textarea>

                        <!-- 歌詞優化快速標籤 -->
                        <div id="lyrics-quick-tags" class="iterate-quick-tags">
                            <button type="button" class="iterate-tag" data-instruction="副歌更有記憶點">更有記憶點</button>
                            <button type="button" class="iterate-tag" data-instruction="加強押韻效果">加強押韻</button>
                            <button type="button" class="iterate-tag" data-instruction="情緒更強烈">情緒更強</button>
                            <button type="button" class="iterate-tag" data-instruction="歌詞更簡潔">更簡潔</button>
                            <button type="button" class="iterate-tag" data-instruction="加入更多 ad-libs">加 Ad-libs</button>
                            <button type="button" class="iterate-tag" data-instruction="調整結構，讓高潮更晚出現">延後高潮</button>
                        </div>

                        <!-- Style 優化快速標籤 -->
                        <div id="style-quick-tags" class="iterate-quick-tags hidden">
                            <button type="button" class="iterate-tag" data-instruction="更有能量感">更有能量</button>
                            <button type="button" class="iterate-tag" data-instruction="更溫柔抒情">更抒情</button>
                            <button type="button" class="iterate-tag" data-instruction="加入更多樂器層次">更多層次</button>
                            <button type="button" class="iterate-tag" data-instruction="更復古懷舊">更復古</button>
                            <button type="button" class="iterate-tag" data-instruction="更現代電子感">更現代</button>
                            <button type="button" class="iterate-tag" data-instruction="加強人聲特色">強化人聲</button>
                        </div>
                    </div>
                    <button id="iterate-btn" class="btn-iterate">
                        <span class="btn-text">優化歌詞</span>
                        <span class="btn-loading" style="display:none;">優化中...</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- 模板編輯頁面 -->
        <div id="template-edit" class="tab-content">
            <div class="editor-layout">
                <div class="editor-sidebar">
                    <h3>快速插入標籤</h3>

                    <!-- 進階 Meta Tags -->
                    <div class="tag-category">
                        <h4>進階結構標籤</h4>
                        <div class="tag-buttons">
                            <button class="tag-btn meta-tag" data-tag="[Chorus | anthemic chorus | stacked harmonies]">副歌+和聲</button>
                            <button class="tag-btn meta-tag" data-tag="[Verse | emotional build-up]">主歌+情緒堆疊</button>
                            <button class="tag-btn meta-tag" data-tag="[Bridge | key change | building energy]">橋段+轉調</button>
                            <button class="tag-btn meta-tag" data-tag="[Drop | explosive energy | 808 sub bass]">電音Drop</button>
                        </div>
                    </div>

                    <div class="tag-category">
                        <h4>結構標籤</h4>
                        <div class="tag-buttons">
                            <button class="tag-btn" data-tag="[Intro]">[Intro]</button>
                            <button class="tag-btn" data-tag="[Verse]">[Verse]</button>
                            <button class="tag-btn" data-tag="[Pre-Chorus]">[Pre-Chorus]</button>
                            <button class="tag-btn" data-tag="[Chorus]">[Chorus]</button>
                            <button class="tag-btn" data-tag="[Post-Chorus]">[Post-Chorus]</button>
                            <button class="tag-btn" data-tag="[Bridge]">[Bridge]</button>
                            <button class="tag-btn" data-tag="[Outro]">[Outro]</button>
                            <button class="tag-btn" data-tag="[Hook]">[Hook]</button>
                            <button class="tag-btn" data-tag="[Break]">[Break]</button>
                            <button class="tag-btn" data-tag="[Breakdown]">[Breakdown]</button>
                            <button class="tag-btn" data-tag="[Build]">[Build]</button>
                            <button class="tag-btn" data-tag="[Interlude]">[Interlude]</button>
                            <button class="tag-btn" data-tag="[End]">[End]</button>
                        </div>
                    </div>
                    <div class="tag-category">
                        <h4>樂器標籤</h4>
                        <div class="tag-buttons">
                            <button class="tag-btn" data-tag="[Instrumental]">[Instrumental]</button>
                            <button class="tag-btn" data-tag="[Guitar Solo]">[Guitar Solo]</button>
                            <button class="tag-btn" data-tag="[Piano Solo]">[Piano Solo]</button>
                            <button class="tag-btn" data-tag="[Drum Break]">[Drum Break]</button>
                            <button class="tag-btn" data-tag="[Bass Drop]">[Bass Drop]</button>
                            <button class="tag-btn" data-tag="[Synth]">[Synth]</button>
                            <button class="tag-btn" data-tag="[Strings]">[Strings]</button>
                            <button class="tag-btn" data-tag="[808 sub bass]">[808]</button>
                        </div>
                    </div>
                    <div class="tag-category">
                        <h4>人聲標籤</h4>
                        <div class="tag-buttons">
                            <button class="tag-btn" data-tag="[Male Vocal]">[Male Vocal]</button>
                            <button class="tag-btn" data-tag="[Female Vocal]">[Female Vocal]</button>
                            <button class="tag-btn" data-tag="[Duet]">[Duet]</button>
                            <button class="tag-btn" data-tag="[Harmony]">[Harmony]</button>
                            <button class="tag-btn" data-tag="[stacked harmonies]">[Stacked Harmonies]</button>
                            <button class="tag-btn" data-tag="[Whisper]">[Whisper]</button>
                            <button class="tag-btn" data-tag="[Rap]">[Rap]</button>
                            <button class="tag-btn" data-tag="[spoken word verse]">[Spoken Word]</button>
                            <button class="tag-btn" data-tag="[raspy lead vocal]">[Raspy]</button>
                            <button class="tag-btn" data-tag="[autotuned delivery]">[Autotune]</button>
                            <button class="tag-btn" data-tag="[crowd-style vocals]">[群眾合唱]</button>
                        </div>
                    </div>
                    <div class="tag-category">
                        <h4>效果/能量標籤</h4>
                        <div class="tag-buttons">
                            <button class="tag-btn" data-tag="[Fade In]">[Fade In]</button>
                            <button class="tag-btn" data-tag="[Fade Out]">[Fade Out]</button>
                            <button class="tag-btn" data-tag="[Build Up]">[Build Up]</button>
                            <button class="tag-btn" data-tag="[Drop]">[Drop]</button>
                            <button class="tag-btn" data-tag="[high energy]">[High Energy]</button>
                            <button class="tag-btn" data-tag="[low energy]">[Low Energy]</button>
                            <button class="tag-btn" data-tag="[building energy]">[Building]</button>
                            <button class="tag-btn" data-tag="[explosive energy]">[Explosive]</button>
                        </div>
                    </div>
                    <div class="tag-category">
                        <h4>情緒標籤</h4>
                        <div class="tag-buttons">
                            <button class="tag-btn" data-tag="[melancholic]">[Melancholic]</button>
                            <button class="tag-btn" data-tag="[euphoric]">[Euphoric]</button>
                            <button class="tag-btn" data-tag="[nostalgic]">[Nostalgic]</button>
                            <button class="tag-btn" data-tag="[dreamy]">[Dreamy]</button>
                            <button class="tag-btn" data-tag="[aggressive]">[Aggressive]</button>
                            <button class="tag-btn" data-tag="[peaceful]">[Peaceful]</button>
                            <button class="tag-btn" data-tag="[mysterious]">[Mysterious]</button>
                        </div>
                    </div>
                    <div class="tag-category">
                        <h4>空間/效果</h4>
                        <div class="tag-buttons">
                            <button class="tag-btn" data-tag="[hall reverb]">[Hall Reverb]</button>
                            <button class="tag-btn" data-tag="[room reverb]">[Room Reverb]</button>
                            <button class="tag-btn" data-tag="[delay]">[Delay]</button>
                            <button class="tag-btn" data-tag="[distortion]">[Distortion]</button>
                            <button class="tag-btn" data-tag="[echo]">[Echo]</button>
                        </div>
                    </div>
                    <div class="tag-category">
                        <h4>音樂技巧/轉變</h4>
                        <div class="tag-buttons">
                            <button class="tag-btn meta-tag" data-tag="[melismatic runs | soulful]">轉音</button>
                            <button class="tag-btn meta-tag" data-tag="[vocal runs]">花式轉音</button>
                            <button class="tag-btn meta-tag" data-tag="[Key Change]">轉調</button>
                            <button class="tag-btn meta-tag" data-tag="[modulation up]">升調</button>
                            <button class="tag-btn meta-tag" data-tag="[modulation down]">降調</button>
                            <button class="tag-btn meta-tag" data-tag="[Style Shift]">風格轉變</button>
                            <button class="tag-btn meta-tag" data-tag="[tempo change]">速度轉變</button>
                            <button class="tag-btn meta-tag" data-tag="[breakdown to buildup]">崩解到堆疊</button>
                        </div>
                    </div>
                    <div class="tag-category">
                        <h4>人聲唱腔</h4>
                        <div class="tag-buttons">
                            <button class="tag-btn" data-tag="[falsetto]">假聲</button>
                            <button class="tag-btn" data-tag="[belting]">飽滿高音</button>
                            <button class="tag-btn" data-tag="[vibrato]">顫音</button>
                            <button class="tag-btn" data-tag="[breathy vocals]">氣聲</button>
                            <button class="tag-btn" data-tag="[soulful ad-libs]">靈魂即興</button>
                            <button class="tag-btn" data-tag="[operatic]">歌劇式</button>
                            <button class="tag-btn" data-tag="[growl]">咆哮</button>
                            <button class="tag-btn" data-tag="[scream]">嘶吼</button>
                        </div>
                    </div>
                    <div class="tag-category">
                        <h4>樂器技巧</h4>
                        <div class="tag-buttons">
                            <button class="tag-btn" data-tag="[fingerpicking guitar]">指彈吉他</button>
                            <button class="tag-btn" data-tag="[palm muted guitar]">悶音吉他</button>
                            <button class="tag-btn" data-tag="[slide guitar]">滑音吉他</button>
                            <button class="tag-btn" data-tag="[arpeggiated chords]">琶音</button>
                            <button class="tag-btn" data-tag="[power chords]">強力和弦</button>
                            <button class="tag-btn" data-tag="[slap bass]">拍弦貝斯</button>
                            <button class="tag-btn" data-tag="[fingerstyle bass]">指彈貝斯</button>
                            <button class="tag-btn" data-tag="[piano staccato]">鋼琴斷奏</button>
                            <button class="tag-btn" data-tag="[piano legato]">鋼琴連奏</button>
                            <button class="tag-btn" data-tag="[drum fill]">鼓過門</button>
                            <button class="tag-btn" data-tag="[hi-hat groove]">Hi-Hat律動</button>
                            <button class="tag-btn" data-tag="[orchestral swell]">管弦漸強</button>
                        </div>
                    </div>
                    <div class="tag-category">
                        <h4>工具標籤</h4>
                        <div class="tag-buttons">
                            <button class="tag-btn special-tag" data-tag="///*****///">防Bleed分隔</button>
                            <button class="tag-btn special-tag" data-tag="[Chorus x2]">[Chorus x2]</button>
                        </div>
                    </div>
                </div>
                <div class="editor-main">
                    <div class="editor-toolbar">
                        <button id="load-template" class="btn-secondary">載入模板</button>
                        <button id="clear-editor" class="btn-secondary">清空</button>
                        <button id="copy-editor" class="btn-secondary">複製全部</button>
                    </div>
                    <textarea id="lyrics-editor" class="lyrics-editor" maxlength="5000" placeholder="在這裡編輯你的歌詞...

範例格式：
[Intro]
[Instrumental]

[Verse 1]
第一段歌詞在這裡
每一行都是一句歌詞

[Chorus]
這是副歌的部分
(oh yeah) ← 這是 ad-lib

[Verse 2]
第二段歌詞...

[Outro]
[Fade Out]"></textarea>
                    <div class="editor-footer">
                        <span id="char-count">0 字元</span>
                        <span id="line-count">0 行</span>
                    </div>
                </div>
            </div>

            <!-- 模板選擇彈窗 -->
            <div id="template-modal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>選擇模板</h3>
                        <button class="modal-close">&times;</button>
                    </div>
                    <div class="modal-body">
                        <div class="template-grid">
                            <div class="template-card" data-template="pop-ballad">
                                <h4>流行抒情</h4>
                                <p>Intro → Verse → Chorus → Verse → Chorus → Bridge → Chorus → Outro</p>
                            </div>
                            <div class="template-card" data-template="rock">
                                <h4>搖滾</h4>
                                <p>Intro → Verse → Chorus → Verse → Chorus → Guitar Solo → Chorus → Outro</p>
                            </div>
                            <div class="template-card" data-template="hip-hop">
                                <h4>嘻哈</h4>
                                <p>Intro → Verse → Hook → Verse → Hook → Bridge → Hook → Outro</p>
                            </div>
                            <div class="template-card" data-template="electronic">
                                <h4>電子舞曲</h4>
                                <p>Intro → Build Up → Drop → Break → Build Up → Drop → Outro</p>
                            </div>
                            <div class="template-card" data-template="simple">
                                <h4>簡單三段式</h4>
                                <p>Verse → Chorus → Verse → Chorus → Outro</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 標籤參考頁面 -->
        <div id="tags-ref" class="tab-content">
            <div class="reference-section">
                <h3>Suno Metatags 完整參考</h3>
                <p class="info-text">Metatags 是放在方括號 [ ] 內的指令，用來控制 Suno AI 生成音樂的結構和風格。</p>

                <div class="ref-category">
                    <h4>結構標籤 (Structure Tags)</h4>
                    <table class="ref-table">
                        <thead>
                            <tr><th>標籤</th><th>說明</th><th>使用建議</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>[Intro]</td><td>歌曲開頭</td><td>通常搭配 [Instrumental]</td></tr>
                            <tr><td>[Verse]</td><td>主歌段落</td><td>可用 [Verse 1], [Verse 2] 區分</td></tr>
                            <tr><td>[Pre-Chorus]</td><td>導歌</td><td>連接主歌和副歌</td></tr>
                            <tr><td>[Chorus]</td><td>副歌</td><td>歌曲最記憶點的部分</td></tr>
                            <tr><td>[Bridge]</td><td>橋段</td><td>通常在第二次副歌後</td></tr>
                            <tr><td>[Outro]</td><td>結尾</td><td>可搭配 [Fade Out]</td></tr>
                            <tr><td>[Hook]</td><td>記憶點段落</td><td>嘻哈常用</td></tr>
                            <tr><td>[Break]</td><td>間奏休息</td><td>暫停或減少元素</td></tr>
                            <tr><td>[Interlude]</td><td>間奏</td><td>純音樂過場</td></tr>
                            <tr><td>[End]</td><td>結束標記</td><td>明確標示歌曲結束</td></tr>
                        </tbody>
                    </table>
                </div>

                <div class="ref-category">
                    <h4>人聲標籤 (Vocal Tags)</h4>
                    <table class="ref-table">
                        <thead>
                            <tr><th>標籤</th><th>說明</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>[Male Vocal]</td><td>男聲</td></tr>
                            <tr><td>[Female Vocal]</td><td>女聲</td></tr>
                            <tr><td>[Duet]</td><td>對唱</td></tr>
                            <tr><td>[Harmony]</td><td>和聲</td></tr>
                            <tr><td>[Whisper]</td><td>輕聲/耳語</td></tr>
                            <tr><td>[Rap]</td><td>饒舌</td></tr>
                            <tr><td>[Spoken]</td><td>口白</td></tr>
                            <tr><td>[Choir]</td><td>合唱團</td></tr>
                        </tbody>
                    </table>
                </div>

                <div class="ref-category">
                    <h4>樂器標籤 (Instrument Tags)</h4>
                    <table class="ref-table">
                        <thead>
                            <tr><th>標籤</th><th>說明</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>[Instrumental]</td><td>純音樂（無人聲）</td></tr>
                            <tr><td>[Guitar Solo]</td><td>吉他獨奏</td></tr>
                            <tr><td>[Piano Solo]</td><td>鋼琴獨奏</td></tr>
                            <tr><td>[Drum Break]</td><td>鼓點段落</td></tr>
                            <tr><td>[Bass Drop]</td><td>低音下降（電子音樂）</td></tr>
                            <tr><td>[Synth]</td><td>合成器</td></tr>
                            <tr><td>[Strings]</td><td>弦樂</td></tr>
                            <tr><td>[Acoustic]</td><td>原聲樂器</td></tr>
                        </tbody>
                    </table>
                </div>

                <div class="ref-category">
                    <h4>效果標籤 (Effect Tags)</h4>
                    <table class="ref-table">
                        <thead>
                            <tr><th>標籤</th><th>說明</th></tr>
                        </thead>
                        <tbody>
                            <tr><td>[Fade In]</td><td>淡入</td></tr>
                            <tr><td>[Fade Out]</td><td>淡出</td></tr>
                            <tr><td>[Build Up]</td><td>漸強堆疊</td></tr>
                            <tr><td>[Drop]</td><td>節拍下降</td></tr>
                            <tr><td>[Big Finish]</td><td>盛大結尾</td></tr>
                        </tbody>
                    </table>
                </div>

                <div class="ref-category">
                    <h4>Ad-libs（即興語句）</h4>
                    <p>使用小括號 ( ) 加入即興語句，會被唱出但不是主歌詞：</p>
                    <div class="code-example">
                        <code>(oh yeah)</code>
                        <code>(hey!)</code>
                        <code>(come on)</code>
                        <code>(啦啦啦)</code>
                    </div>
                </div>

                <div class="ref-tips">
                    <h4>使用技巧</h4>
                    <ul>
                        <li>標籤保持簡短，1-3 個字效果最好</li>
                        <li>可以在標籤後加描述詞，如 <code>[Catchy Chorus]</code></li>
                        <li>不要過度使用標籤，會降低效果</li>
                        <li>Suno V5 對標籤的解析更準確</li>
                    </ul>
                </div>
            </div>
        </div>

        <footer>
            <p>Suno 歌詞產生器 | 使用 Claude API 生成</p>
            <p class="footer-links">
                <a href="https://sunoaiwiki.com/resources/2024-05-13-list-of-metatags/" target="_blank">Suno Wiki</a> |
                <a href="https://jackrighteous.com/en-us/pages/suno-ai-meta-tags-guide" target="_blank">Meta Tags Guide</a>
            </p>
        </footer>
    </div>

    <script src="app.js"></script>
</body>
</html>
